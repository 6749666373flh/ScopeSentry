import{d as e,N as t,e as a,V as l,S as o,r as i,o as r,i as s,w as n,a as d,H as p,t as u,R as m,I as c,Y as f,l as y}from"./index-M10etHi6.js";import{E as x,a as b}from"./el-tab-pane-8bwOwYDC.js";import{E as _,a as g}from"./el-form-A-pj7LuS.js";import{a as w,E as h}from"./el-radio-group-B0psiKnF.js";import{E as v}from"./el-tag-DC4eDhDo.js";import{E as j}from"./el-space-BF0B9RwX.js";import{r as S}from"./index-MoA9wocQ.js";import{_ as E}from"./Table.vue_vue_type_script_lang-9x4PpCFP.js";import{u as R}from"./useTable-D1SpGQrv.js";const T=e=>S.post({url:"/api/export/delete",data:{ids:e}});function C(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!f(e)}const V=e({__name:"exportData",props:{index:{},searchParams:{}},setup(e){const{t:f}=y(),V=e,k=t({type:"all",quantity:0}),q=async()=>{var e,t,a,l;F.value=!0,await(e=V.index,t=k.quantity,a=k.type,l=V.searchParams,S.post({url:"/api/export",data:{index:e,quantity:t,type:a,search:l}})),F.value=!1},A=t([{field:"selection",type:"selection"},{field:"file_name",label:f("export.fileName"),width:"160"},{field:"state",label:f("export.state"),width:"160",formatter:(e,t,l)=>{if(0==l){let e;return a(v,{type:"info"},C(e=f("export.run"))?e:{default:()=>[e]})}if(1==l){let e;return a(v,{type:"success"},C(e=f("export.success"))?e:{default:()=>[e]})}{let e;return a(v,{type:"danger"},C(e=f("export.fail"))?e:{default:()=>[e]})}}},{field:"create_time",label:f("export.createTime"),width:"160"},{field:"end_time",label:f("export.endTime"),width:"160",formatter:(e,t,a)=>""==a?"-":a},{field:"data_type",label:f("export.type"),width:"120"},{field:"file_size",label:f("export.fileSize"),width:"100",formatter:(e,t,a)=>""==a?"-":a+" MB"},{field:"action",label:f("tableDemo.action"),width:"200",formatter:(e,t,i)=>{let r,s;return a(o,null,[a(l,{type:"success",onClick:()=>B(e.file_name)},C(r=f("export.download"))?r:{default:()=>[r]}),a(l,{type:"danger",onClick:()=>O(e)},C(s=f("common.delete"))?s:{default:()=>[s]})])}}]),{tableRegister:N,tableState:U,tableMethods:I}=R({fetchDataApi:async()=>({list:(await S.get({url:"/api/export/record"})).data.list}),immediate:!1}),{dataList:z,loading:D}=U,{getList:M,getElTableExpose:P}=I,B=async e=>{const t=document.createElement("a");t.href="/api/export/download?file_name="+e,t.click()},F=i(!1),H=e=>{"exportRecords"==e&&M()},L=i(!1),O=async e=>{window.confirm("Are you sure you want to delete the selected data?")&&await Q(e)},Q=async e=>{L.value=!0;try{await T([e.file_name]);L.value=!1,M()}catch(t){L.value=!1,M()}},W=async()=>{window.confirm("Are you sure you want to delete the selected data?")&&await $()},Y=i([]),$=async()=>{const e=await P(),t=(null==e?void 0:e.getSelectionRows())||[];Y.value=t.map((e=>e.file_name)),L.value=!0;try{await T(Y.value);L.value=!1,M()}catch(a){L.value=!1,M()}};return(e,t)=>(r(),s(d(b),{tabPosition:"left",onTabChange:H,"model-value":"export"},{default:n((()=>[a(d(x),{label:d(f)("asset.export"),name:"export"},{default:n((()=>[a(d(_),{model:k,"label-width":"auto",style:{position:"relative"}},{default:n((()=>[a(d(g),{label:d(f)("export.exportType")},{default:n((()=>[a(d(w),{modelValue:k.type,"onUpdate:modelValue":t[0]||(t[0]=e=>k.type=e)},{default:n((()=>[a(d(h),{value:"all"},{default:n((()=>[p(u(d(f)("export.exportTypeAll")),1)])),_:1}),a(d(h),{value:"search"},{default:n((()=>[p(u(d(f)("export.exportTypeSearch")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),a(d(g),{label:d(f)("export.exportQuantity")},{default:n((()=>[a(d(m),{modelValue:k.quantity,"onUpdate:modelValue":t[1]||(t[1]=e=>k.quantity=e)},null,8,["modelValue"])])),_:1},8,["label"]),a(d(g),null,{default:n((()=>[a(d(c),{type:"primary",onClick:q,style:{left:"40%",position:"relative"},loading:F.value},{default:n((()=>[p(" Create ")])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1},8,["label"]),a(d(x),{label:d(f)("export.exportRecords"),name:"exportRecords"},{default:n((()=>[a(d(j),{direction:"vertical",alignment:"flex-start"},{default:n((()=>[a(d(l),{type:"danger",loading:L.value,onClick:W},{default:n((()=>[p(u(d(f)("common.delete")),1)])),_:1},8,["loading"]),a(d(E),{onRegister:d(N),columns:A,data:d(z),loading:d(D),"max-height":"500",style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"}},null,8,["onRegister","columns","data","loading"])])),_:1})])),_:1},8,["label"])])),_:1}))}});export{V as _};
