import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-myE6dPy2.js";import{d as a,dE as l,N as t,r as o,a2 as s,o as i,c as n,e as r,w as p,a as d,I as u,f as c,t as m,H as v,D as f,S as g,a5 as h,i as y,j as _,a6 as x,l as j,Z as b,a0 as w,_ as k}from"./index-M10etHi6.js";import{a as C,E as S}from"./el-col-CNNqU05O.js";import{E as H,a as V}from"./el-table-column-Ct9f4goZ.js";import"./el-checkbox-C3AB5jlc.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-D4B4f19J.js";import{E}from"./el-tag-DC4eDhDo.js";import{E as $}from"./el-text-Bjb0AW85.js";import{E as F}from"./el-divider-DaZuXLuF.js";import{E as T,a as z}from"./el-tree-select-kViTL7JI.js";import{b as L,E as D,a as I}from"./el-dropdown-item-6vek0JLM.js";import"./el-select-CQG17R-n.js";/* empty css                */import{E as U}from"./el-switch-CoMa2y0Z.js";import{_ as N}from"./Dialog.vue_vue_type_style_index_0_lang-Cx7rWX1S.js";import{u as O}from"./useIcon-DPW7aAst.js";import{_ as W}from"./exportData.vue_vue_type_script_setup_true_lang-o7DCmuQ7.js";import{r as q}from"./index-Dm5pqZ45.js";import"./el-card-t9G4RzyN.js";import"./index-BEjIPMze.js";import"./debounce-DMlGG38r.js";import"./isArrayLikeObject-CmTAjD1K.js";import"./raf-ChTn_6oX.js";import"./index-BS5tVDa_.js";import"./strings-DKCbZfke.js";import"./el-pagination-DKV_XtBQ.js";import"./castArray-D86glhSN.js";import"./refs-DEjEOHCT.js";import"./useInput-DFHJnJFD.js";import"./el-tab-pane-8bwOwYDC.js";import"./el-form-A-pj7LuS.js";import"./el-radio-group-B0psiKnF.js";import"./el-space-BF0B9RwX.js";import"./index-MoA9wocQ.js";import"./Table.vue_vue_type_script_lang-9x4PpCFP.js";import"./el-image-viewer-CAmikf02.js";import"./el-empty-DtGCvYos.js";import"./tsxHelper-Cy1d83nC.js";import"./index-D4oHVQnn.js";import"./useTable-D1SpGQrv.js";const A={style:{float:"left"}},K={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},B={class:"custom-dropdown"},J={key:0,class:"dropdown-item"},P={class:"label-text"},R={class:"label-text"},Z={class:"flex gap-2"},M=k(a({__name:"Csearch",props:{getList:{type:Function},handleSearch:{type:Function},searchKeywordsData:{},index:{},getElTableExpose:{type:Function},handleFilterSearch:{type:Function},projectList:{},dynamicTags:{},handleClose:{type:Function},openAggregation:{type:Function},crudSchemas:{},statisticsHidden:{type:Boolean},changeStatisticsHidden:{type:Function}},emits:["update-column-visibility"],setup(a,{emit:k}){const{t:M}=j(),{query:X}=l(),Y=a,G=t([...Y.searchKeywordsData]),Q={keyword:"task",example:'task=="test"',explain:M("searchHelp.taskName")};G.push(Q),G.push({keyword:"tag",example:'tag=="test"',explain:"find tags"});const ee=[{operator:"=",meaning:M("searchHelp.like"),value:'=""'},{operator:"!=",meaning:M("searchHelp.notIn"),value:'!=""'},{operator:"==",meaning:M("searchHelp.equal"),value:'==""'}],ae=[{operator:"&&",meaning:M("searchHelp.and"),value:"&&",logic:"1"},{operator:"||",meaning:M("searchHelp.or"),value:"||",logic:"1"},{operator:"()",meaning:M("searchHelp.brackets"),value:"()",logic:"1"}],le=ee.concat(ae),te=o(!1);(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${Y.index}`)||"{}");Y.crudSchemas.forEach((a=>{void 0!==e[a.field]&&(a.hidden=e[a.field])}))})(),s((()=>Y.crudSchemas),(()=>{(()=>{const e=Y.crudSchemas.reduce(((e,a)=>("select"!=a.field&&(e[a.field]=a.hidden),e)),{});localStorage.setItem(`columnConfig_${Y.index}`,JSON.stringify(e))})()}),{deep:!0});const oe=()=>{te.value=!0};function se(){return{background:"var(--el-fill-color-light)"}}const ie=o(""),ne=O({icon:"iconoir:search"}),re=O({icon:"tdesign:chat-bubble-help"}),pe=O({icon:"ri:arrow-drop-down-line"}),de=O({icon:"ph:export-light"}),ue=O({icon:"carbon:data-vis-1"}),ce=O({icon:"openmoji:delete"}),me=o(!1),ve=()=>{me.value=!0},fe=o([]),ge=async()=>{b.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{const e=await Y.getElTableExpose(),a=(null==e?void 0:e.getSelectionRows())||[];fe.value=a.map((e=>e.id)),await q(fe.value,Y.index),Y.getList()})).catch((()=>{w({type:"info",message:"Delete canceled"})}))},he=o(""),ye=o(!1),_e=o(!1);let xe=o(!0),je=o(!1),be=o(!1);const we=(e,a)=>{if(he.value=e,""==e&&(xe.value=!0,be.value=!1,je.value=!1),xe.value){be.value&&(e=e.replace(he.value,"").trim());a(G.filter((a=>a.keyword.toLowerCase().includes(e.toLowerCase()))))}else if(je.value){const l=e.replace(he.value,"").trim();a(ee.filter((e=>e.operator.includes(l))))}else if(be.value&&e.endsWith(" ")){const l=e.replace(ie.value,"").trim();a(ae.filter((e=>e.operator.includes(l))))}else a([])},ke=e=>{if(e.keyword){let a="";a=be.value?he.value+e.keyword:e.keyword,he.value=a,ie.value=a,ye.value=!0,xe.value=!1,je.value=!0}else e.logic?(ie.value=`${he.value}${e.value}`,he.value=ie.value,xe.value=!0):(ie.value=`${he.value}${e.value}`,he.value=ie.value,_e.value=!0,je.value=!1,be.value=!0)},Ce=o(!1),Se=o([]);s((()=>Se.value),(e=>{(async()=>{Y.handleFilterSearch(ie.value,{project:Se.value})})()}));const He=o(Y.dynamicTags?[...Y.dynamicTags]:[]),Ve=()=>{const e={};He.value.forEach((a=>{const[l,t]=a.split("=");l in e?e[l].push(t):e[l]=[t]})),e.project=Se.value,Y.handleFilterSearch(ie.value,e)};let Ee=X.task;void 0!==Ee&&""!==Ee&&He.value.push(`task=${Ee}`),Ve(),s((()=>Y.dynamicTags),(e=>{He.value=e?[...e]:[],Ve()}),{immediate:!1});const $e=k,Fe=o(Y.statisticsHidden),Te=()=>{location.reload()};return(a,l)=>(i(),n(g,null,[r(d(e),null,{default:p((()=>[r(d(C),{class:"row-bg",gutter:20},{default:p((()=>[r(d(S),{span:6},{default:p((()=>[r(d(T),{modelValue:ie.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ie.value=e),"fetch-suggestions":we,placeholder:d(M)("form.input"),popperClass:"my-autocomplete",onSelect:ke,style:{width:"100%"}},{append:p((()=>[r(d(u),{onClick:oe,text:"",style:{display:"contents"},icon:d(re)},null,8,["icon"])])),default:p((({item:e})=>[c("span",A,m(e.keyword||e.operator),1),c("span",K,m(e.explain||e.meaning),1)])),_:1},8,["modelValue","placeholder"])])),_:1}),r(d(S),{span:1.5},{default:p((()=>[r(d(u),{type:"primary",icon:d(ne),onClick:l[1]||(l[1]=e=>a.$props.handleSearch(ie.value))},{default:p((()=>[v(m(d(M)("form.input")),1)])),_:1},8,["icon"])])),_:1}),r(d(S),{span:1.5},{default:p((()=>[r(d(u),{type:"primary",onClick:ve,icon:d(de)},{default:p((()=>[v(m(d(M)("asset.export")),1)])),_:1},8,["icon"])])),_:1}),r(d(S),{span:4},{default:p((()=>[r(d(z),{loading:Ce.value,modelValue:Se.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Se.value=e),data:a.$props.projectList,placeholder:d(M)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["loading","modelValue","data","placeholder"])])),_:1}),r(d(S),{span:1.5,xs:1.5,sm:1.5,md:1.5},{default:p((()=>[r(d(L),{trigger:"click"},{dropdown:p((()=>[r(d(D),null,{default:p((()=>[r(d(I),{icon:d(ce),onClick:ge},{default:p((()=>[v(m(d(M)("common.delete")),1)])),_:1},8,["icon"])])),_:1})])),default:p((()=>[r(d(u),{plain:"",class:"custom-button align-bottom"},{default:p((()=>[v(m(d(M)("common.operation"))+" ",1),r(d(f),{class:"el-icon--right"},{default:p((()=>[r(d(pe))])),_:1})])),_:1})])),_:1})])),_:1}),r(d(S),{span:1,style:{display:"flex","align-items":"center"}},{default:p((()=>[r(d(L),null,{dropdown:p((()=>[r(d(D),null,{default:p((()=>[(i(!0),n(g,null,h(a.crudSchemas,((e,a)=>(i(),y(d(I),{key:a},{default:p((()=>["selection"!=e.field?(i(),n("div",J,[c("span",P,m(e.label),1),r(d(U),{size:"small",modelValue:e.hidden,"onUpdate:modelValue":a=>e.hidden=a,"active-value":!1,"inactive-value":!0,onChange:a=>(e=>{$e("update-column-visibility",{field:e.field,hidden:e.hidden})})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):_("",!0)])),_:2},1024)))),128)),"asset"==a.$props.index?(i(),y(d(I),{key:0},{default:p((()=>[c("span",R,m(d(M)("asset.Chart")),1),r(d(U),{size:"small",modelValue:Fe.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Fe.value=e),"active-value":!1,"inactive-value":!0,onChange:l[4]||(l[4]=e=>a.changeStatisticsHidden(Fe.value))},null,8,["modelValue"])])),_:1})):_("",!0),r(d(I),{divided:""},{default:p((()=>[r(d(u),{style:{width:"100%"},type:"primary",onClick:Te},{default:p((()=>[v("Save")])),_:1})])),_:1})])),_:1})])),default:p((()=>[c("div",B,[r(d(x),{icon:"ant-design:setting-outlined",class:"cursor-pointer"})])])),_:1})])),_:1}),r(d(S),{span:2,xs:2,sm:2,md:2},{default:p((()=>["SensitiveResult"==a.index?(i(),y(d(u),{key:0,type:"success",onClick:a.$props.openAggregation,icon:d(ue)},{default:p((()=>[v(m(d(M)("project.aggregation")),1)])),_:1},8,["onClick","icon"])):_("",!0)])),_:1})])),_:1}),r(d(C),{style:{"margin-top":"10px"}},{default:p((()=>[r(d(S),{span:24},{default:p((()=>[c("div",Z,[(i(!0),n(g,null,h(He.value,(e=>(i(),y(d(E),{key:e,closable:"","disable-transitions":!1,type:"info",size:"small",onClose:a=>function(e){Y.handleClose&&Y.handleClose(e)}(e)},{default:p((()=>[v(m(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1})])),_:1})])),_:1}),r(d(N),{modelValue:te.value,"onUpdate:modelValue":l[5]||(l[5]=e=>te.value=e),title:d(M)("common.querysyntax"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:p((()=>[r(d(C),null,{default:p((()=>[r(d(S),null,{default:p((()=>[r(d($),{tag:"b",size:"small"},{default:p((()=>[v(m(d(M)("searchHelp.operator")),1)])),_:1}),r(d(F),{direction:"vertical"}),r(d($),{size:"small",type:"danger"},{default:p((()=>[v(m(d(M)("searchHelp.notice")),1)])),_:1})])),_:1}),r(d(S),{style:{"margin-top":"10px"}},{default:p((()=>[r(d(H),{headerCellStyle:se,data:d(le)},{default:p((()=>[r(d(V),{prop:"operator",label:d(M)("searchHelp.operator"),width:"300"},null,8,["label"]),r(d(V),{prop:"meaning",label:d(M)("searchHelp.meaning")},null,8,["label"])])),_:1},8,["data"])])),_:1}),r(d(S),{style:{"margin-top":"15px"}},{default:p((()=>[r(d($),{tag:"b",size:"small"},{default:p((()=>[v(m(d(M)("searchHelp.keywords")),1)])),_:1})])),_:1}),r(d(S),{style:{"margin-top":"10px"}},{default:p((()=>[r(d(H),{headerCellStyle:se,data:G},{default:p((()=>[r(d(V),{prop:"keyword",label:d(M)("searchHelp.keywords")},null,8,["label"]),r(d(V),{prop:"example",label:d(M)("searchHelp.example")},null,8,["label"]),r(d(V),{prop:"explain",label:d(M)("searchHelp.explain")},null,8,["label"])])),_:1},8,["data"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"]),r(d(N),{modelValue:me.value,"onUpdate:modelValue":l[6]||(l[6]=e=>me.value=e),title:d(M)("asset.export"),center:"","max-height":"300",width:"auto",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:p((()=>[r(W,{index:a.$props.index,searchParams:ie.value},null,8,["index","searchParams"])])),_:1},8,["modelValue","title"])],64))}}),[["__scopeId","data-v-4c26abd1"]]);export{M as default};
