import{d as e,N as a,r as l,W as t,a2 as s,o,c as d,e as n,w as u,a as i,R as r,H as p,i as m,j as c,t as f,I as g,an as h,S as k,a5 as _,l as b,a0 as v,f as y}from"./index-DI3N4DDI.js";import{E as V}from"./el-checkbox-Df5USE6T.js";import{E as x}from"./el-divider-CWUgdrsM.js";import{a as w,E as j}from"./el-form-Bgr1UCE8.js";import{a as T,E as N}from"./el-col-BEOU1v5m.js";import{E}from"./el-switch-THXGS1Q1.js";import"./el-tooltip-l0sNRNKZ.js";import{E as U}from"./el-popper-B9xEIKf9.js";import{a as C,E as D}from"./el-radio-group-DxpMR3lM.js";import"./el-tag-CQw-CsVu.js";import"./el-virtual-list-GBZDlwu7.js";import{E as M}from"./el-select-v2-Cbe3chUG.js";import{a as q,E as z}from"./el-select-D7UeB03W.js";import{E as A}from"./el-input-number-C1r683q1.js";import{E as I}from"./el-text-CnhbgniK.js";import{a as S}from"./index-B53TvVVO.js";import{h as B,i as F,f as L,j as P,k as H}from"./index-Czp1rAbc.js";import{_ as R}from"./Dialog.vue_vue_type_style_index_0_lang-CB0H7wcP.js";import G from"./DetailTemplate-DG0hOsQR.js";const J={style:{float:"left"}},K=e({__name:"AddTask",props:{closeDialog:{type:Function},getList:{type:Function},create:{type:Boolean},schedule:{type:Boolean},taskid:{}},setup(e){const{t:K}=b(),W=e,O=a({name:[{required:!0,message:K("task.msgTaskName"),trigger:"blur"}],target:[{required:!0,message:K("task.msgTarget"),trigger:"blur"}],node:[{required:!0,message:K("task.nodeMsg"),trigger:"blur"}],template:[{required:!0,message:"Please select template",trigger:"blur"}]}),Q=l(!1),X=l(),Y=a([]),Z=a([]),$=async()=>{Z.length=0;const e=await L("",1,1e3);e.data.list.length>0&&e.data.list.forEach((e=>{Z.push({value:e.id,label:e.name})}))};t((()=>{(async()=>{const e=await S();e.data.list.length>0?(ae.value=!1,e.data.list.forEach((e=>{Y.push({value:e,label:e})}))):(ae.value=!0,v.warning(K("node.onlineNodeMsg")))})(),$()}));const ee=l(!1),ae=l(!1),le=a({name:"",target:"",ignore:"",node:[],allNode:!0,scheduledTasks:!1,hour:24,duplicates:"None",template:""}),te=e=>{ee.value=!1,e?(le.node=[],Y.forEach((e=>le.node.push(e.value)))):le.node=[]},se=l(""),oe=l(!1);let de=K("task.addTemplate");const ne=async e=>{se.value=e,""!=e&&(de=K("task.editTemplate")),oe.value=!0},ue=()=>{oe.value=!1};return s((()=>W.taskid),(async e=>{e?W.schedule?await(async e=>{const a=await H(e);le.name=a.data.name,le.target=a.data.target,le.ignore=a.data.ignore,le.node=a.data.node,le.allNode=a.data.allNode,le.scheduledTasks=a.data.scheduledTasks,le.hour=a.data.hour,le.duplicates=a.data.duplicates,le.template=a.data.template})(e):await(async e=>{const a=await P(e);le.name=a.data.name,le.target=a.data.target,le.ignore=a.data.ignore,le.node=a.data.node,le.allNode=a.data.allNode,le.scheduledTasks=a.data.scheduledTasks,le.hour=a.data.hour,le.duplicates=a.data.duplicates,le.template=a.data.template})(e):(le.name="",le.target="",le.ignore="",le.node=[],le.allNode=!0,le.scheduledTasks=!1,le.hour=24,le.duplicates="None",le.template="")}),{immediate:!0}),(e,a)=>(o(),d(k,null,[n(i(j),{model:le,"label-width":"auto",rules:O,"status-icon":"",ref_key:"ruleFormRef",ref:X,disabled:!e.create},{default:u((()=>[n(i(w),{label:i(K)("task.taskName"),prop:"name"},{default:u((()=>[n(i(r),{modelValue:le.name,"onUpdate:modelValue":a[0]||(a[0]=e=>le.name=e),placeholder:i(K)("task.msgTaskName")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),n(i(w),{label:i(K)("task.taskTarget"),prop:"target"},{default:u((()=>[n(i(r),{modelValue:le.target,"onUpdate:modelValue":a[1]||(a[1]=e=>le.target=e),placeholder:i(K)("task.msgTarget"),type:"textarea",rows:"10"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),n(i(w),{label:i(K)("task.ignore"),prop:"ignore"},{default:u((()=>[n(i(r),{modelValue:le.ignore,"onUpdate:modelValue":a[2]||(a[2]=e=>le.ignore=e),placeholder:i(K)("task.ignoreMsg"),type:"textarea",rows:"10"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),n(i(T),null,{default:u((()=>[n(i(N),{span:12},{default:u((()=>[n(i(w),{label:i(K)("task.nodeSelect"),prop:"node"},{default:u((()=>[n(i(M),{modelValue:le.node,"onUpdate:modelValue":a[3]||(a[3]=e=>le.node=e),filterable:"",options:Y,placeholder:"Please select node",style:{width:"80%"},multiple:"","tag-type":"success","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":7},{header:u((()=>[n(i(V),{disabled:ae.value,indeterminate:ee.value,onChange:te},{default:u((()=>[p(" All ")])),_:1},8,["disabled","indeterminate"])])),_:1},8,["modelValue","options"])])),_:1},8,["label"])])),_:1}),n(i(N),{span:12},{default:u((()=>[n(i(w),{label:i(K)("task.autoNode")},{default:u((()=>[n(i(U),{effect:"dark",content:i(K)("task.selectNodeMsg"),placement:"top"},{default:u((()=>[n(i(E),{modelValue:le.allNode,"onUpdate:modelValue":a[4]||(a[4]=e=>le.allNode=e),"inline-prompt":"","active-text":i(K)("common.switchAction"),"inactive-text":i(K)("common.switchInactive")},null,8,["modelValue","active-text","inactive-text"])])),_:1},8,["content"])])),_:1},8,["label"])])),_:1})])),_:1}),n(i(T),null,{default:u((()=>[n(i(N),{span:12},{default:u((()=>[n(i(w),{label:i(K)("project.scheduledTasks")},{default:u((()=>[n(i(U),{effect:"dark",content:i(K)("project.msgScheduledTasks"),placement:"top"},{default:u((()=>[n(i(E),{modelValue:le.scheduledTasks,"onUpdate:modelValue":a[5]||(a[5]=e=>le.scheduledTasks=e),"inline-prompt":"","active-text":i(K)("common.switchAction"),"inactive-text":i(K)("common.switchInactive")},null,8,["modelValue","active-text","inactive-text"])])),_:1},8,["content"])])),_:1},8,["label"])])),_:1}),le.scheduledTasks?(o(),m(i(N),{key:0,span:12},{default:u((()=>[n(i(w),{label:i(K)("project.cycle"),prop:"type"},{default:u((()=>[n(i(A),{modelValue:le.hour,"onUpdate:modelValue":a[6]||(a[6]=e=>le.hour=e),min:1,"controls-position":"right",size:"small"},null,8,["modelValue"]),n(i(I),{style:{position:"relative",left:"16px"}},{default:u((()=>[p("Hour")])),_:1})])),_:1},8,["label"])])),_:1})):c("",!0)])),_:1}),n(i(x),{"content-position":"center",style:{width:"60%",left:"20%"}},{default:u((()=>[p(f(i(K)("task.duplicates")),1)])),_:1}),n(i(T),null,{default:u((()=>[n(i(N),{span:24},{default:u((()=>[n(i(w),{label:i(K)("task.duplicates"),prop:"type"},{default:u((()=>[n(i(C),{modelValue:le.duplicates,"onUpdate:modelValue":a[7]||(a[7]=e=>le.duplicates=e)},{default:u((()=>[n(i(D),{label:"None",name:"duplicates",checked:!0,value:"None"}),n(i(U),{effect:"dark",content:i(K)("task.duplicatesMsg"),placement:"top"},{default:u((()=>[n(i(D),{label:i(K)("task.duplicatesSubdomain"),name:"duplicates",value:"subdomain"},null,8,["label"])])),_:1},8,["content"])])),_:1},8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1}),n(i(x),{"content-position":"center",style:{width:"60%",left:"20%"}},{default:u((()=>[p(f(i(K)("router.scanTemplate")),1)])),_:1}),n(i(w),{label:i(K)("router.scanTemplate"),prop:"template"},{default:u((()=>[n(i(q),{modelValue:le.template,"onUpdate:modelValue":a[9]||(a[9]=e=>le.template=e),placeholder:"Please select template",style:{width:"30%"}},{footer:u((()=>[n(i(g),{type:"success",size:"small",plain:"",style:{"margin-left":"15px"},onClick:a[8]||(a[8]=h((e=>ne("")),["stop"]))},{default:u((()=>[p(f(i(K)("common.new")),1)])),_:1})])),default:u((()=>[(o(!0),d(k,null,_(Z,(e=>(o(),m(i(z),{key:e.value,label:e.label,value:e.value},{default:u((()=>[n(i(T),null,{default:u((()=>[n(i(N),{span:16},{default:u((()=>[y("span",J,f(e.label),1)])),_:2},1024),n(i(N),{span:8},{default:u((()=>[n(i(g),{type:"primary",size:"small",style:{"margin-left":"15px"},onClick:h((a=>ne(e.value)),["stop"])},{default:u((()=>[p(f(i(K)("common.edit")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),n(i(x)),n(i(T),null,{default:u((()=>[n(i(N),{span:2,offset:10},{default:u((()=>[n(i(w),null,{default:u((()=>[n(i(g),{type:"primary",onClick:a[10]||(a[10]=e=>(async e=>{Q.value=!0;try{if(!e)return;if(await e.validate()){let e;e=W.taskid?await B(W.taskid,le.name,le.target,le.ignore,le.node,le.allNode,le.duplicates,le.scheduledTasks,le.hour,le.template):await F(le.name,le.target,le.ignore,le.node,le.allNode,le.duplicates,le.scheduledTasks,le.hour,le.template),200===e.code&&(W.closeDialog(),W.getList())}}catch(a){}finally{Q.value=!1}})(X.value)),loading:Q.value},{default:u((()=>[p(f(i(K)("task.save")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","disabled"]),n(i(R),{modelValue:oe.value,"onUpdate:modelValue":a[11]||(a[11]=e=>oe.value=e),title:i(de),center:"",fullscreen:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:u((()=>[n(G,{closeDialog:ue,getList:$,id:se.value},null,8,["id"])])),_:1},8,["modelValue","title"])],64))}});export{K as _};
