import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-4BKB8u1e.js";import{d as a,dC as l,s as t,r as o,O as s,o as i,c as n,e as r,w as p,a as d,z as u,A as c,f as m,t as v,y as f,F as g,R as h,i as y,j as _,S as x,l as b,J as j,L as w,_ as k}from"./index-uu-sb1xd.js";import{a as C,E as S}from"./el-col-WgK5lZ8C.js";import{E as H,a as V}from"./el-table-column-B1k3mfGa.js";import"./el-checkbox--BT0mwB_.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-Q1oSUg9s.js";import{E}from"./el-tag-DNcAhGYG.js";import{E as $}from"./el-text-NlJ9zSH3.js";import{E as F}from"./el-divider-B8qt-fQU.js";import{E as T,a as z}from"./el-tree-select-BqlABA5E.js";import{b as L,E as U,a as D}from"./el-dropdown-item-4FW6tlcv.js";import"./el-select-Cy5vHOir.js";import{E as I}from"./el-switch-C75eVKe5.js";import{_ as A}from"./Dialog.vue_vue_type_style_index_0_lang-CGAs61e8.js";import{u as O}from"./useIcon-D1SBaDFU.js";import{_ as W}from"./exportData.vue_vue_type_script_setup_true_lang-BZ635QBJ.js";import{r as J}from"./index-DLja4XEC.js";import"./el-card-C9jj0kus.js";import"./index-BCiLOhqr.js";import"./debounce-lsqC8295.js";import"./isArrayLikeObject-CYjxtax4.js";import"./raf-D1egjexT.js";import"./index-Dr7ZuJyn.js";import"./strings-DlngudI4.js";import"./el-pagination-CDDD20a2.js";import"./castArray-rIphTaLC.js";import"./refs-BPcd29qY.js";import"./useInput-CDx1l06s.js";import"./el-tab-pane-CXmnhRPe.js";import"./el-form-FbaxIhwc.js";import"./el-radio-group-B-BY-EST.js";import"./el-space-CvFLsQII.js";import"./index-C0gm2Z3K.js";import"./Table.vue_vue_type_script_lang-DR1NSdjE.js";import"./el-image-viewer-BokRXDKf.js";import"./el-empty-iWt115hX.js";import"./tsxHelper-zo-x7Wbp.js";import"./index-DmBPbhxn.js";import"./useTable-DMMi3sga.js";const K={style:{float:"left"}},N={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},q={class:"custom-dropdown"},B={key:0,class:"dropdown-item"},R={class:"label-text"},P={class:"label-text"},M={class:"flex gap-2"},X=k(a({__name:"Csearch",props:{getList:{type:Function},handleSearch:{type:Function},searchKeywordsData:{},index:{},getElTableExpose:{type:Function},handleFilterSearch:{type:Function},projectList:{},dynamicTags:{},handleClose:{type:Function},openAggregation:{type:Function},crudSchemas:{},statisticsHidden:{type:Boolean},changeStatisticsHidden:{type:Function}},emits:["update-column-visibility"],setup(a,{emit:k}){const{t:X}=b(),{query:Z}=l(),G=a,Q=t([...G.searchKeywordsData]),Y={keyword:"task",example:'task=="test"',explain:X("searchHelp.taskName")};Q.push(Y);const ee=[{operator:"=",meaning:X("searchHelp.like"),value:'=""'},{operator:"!=",meaning:X("searchHelp.notIn"),value:'!=""'},{operator:"==",meaning:X("searchHelp.equal"),value:'==""'}],ae=[{operator:"&&",meaning:X("searchHelp.and"),value:"&&",logic:"1"},{operator:"||",meaning:X("searchHelp.or"),value:"||",logic:"1"},{operator:"()",meaning:X("searchHelp.brackets"),value:"()",logic:"1"}],le=ee.concat(ae),te=o(!1);(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${G.index}`)||"{}");G.crudSchemas.forEach((a=>{void 0!==e[a.field]&&(a.hidden=e[a.field])}))})(),s((()=>G.crudSchemas),(()=>{(()=>{const e=G.crudSchemas.reduce(((e,a)=>("select"!=a.field&&(e[a.field]=a.hidden),e)),{});localStorage.setItem(`columnConfig_${G.index}`,JSON.stringify(e))})()}),{deep:!0});const oe=()=>{te.value=!0};function se(){return{background:"var(--el-fill-color-light)"}}const ie=o(""),ne=O({icon:"iconoir:search"}),re=O({icon:"tdesign:chat-bubble-help"}),pe=O({icon:"ri:arrow-drop-down-line"}),de=O({icon:"ph:export-light"}),ue=O({icon:"carbon:data-vis-1"}),ce=O({icon:"openmoji:delete"}),me=o(!1),ve=()=>{me.value=!0},fe=o([]),ge=async()=>{j.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{const e=await G.getElTableExpose(),a=(null==e?void 0:e.getSelectionRows())||[];fe.value=a.map((e=>e.id)),await J(fe.value,G.index),G.getList()})).catch((()=>{w({type:"info",message:"Delete canceled"})}))},he=o(""),ye=o(!1),_e=o(!1);let xe=o(!0),be=o(!1),je=o(!1);const we=(e,a)=>{if(he.value=e,""==e&&(xe.value=!0,je.value=!1,be.value=!1),xe.value){je.value&&(e=e.replace(he.value,"").trim());a(Q.filter((a=>a.keyword.toLowerCase().includes(e.toLowerCase()))))}else if(be.value){const l=e.replace(he.value,"").trim();a(ee.filter((e=>e.operator.includes(l))))}else if(je.value&&e.endsWith(" ")){const l=e.replace(ie.value,"").trim();a(ae.filter((e=>e.operator.includes(l))))}else a([])},ke=e=>{if(e.keyword){let a="";a=je.value?he.value+e.keyword:e.keyword,he.value=a,ie.value=a,ye.value=!0,xe.value=!1,be.value=!0}else e.logic?(ie.value=`${he.value}${e.value}`,he.value=ie.value,xe.value=!0):(ie.value=`${he.value}${e.value}`,he.value=ie.value,_e.value=!0,be.value=!1,je.value=!0)},Ce=o(!1),Se=o([]);s((()=>Se.value),(e=>{(async()=>{G.handleFilterSearch(ie.value,{project:Se.value})})()}));const He=o(G.dynamicTags?[...G.dynamicTags]:[]),Ve=()=>{const e={};He.value.forEach((a=>{const[l,t]=a.split("=");l in e?e[l].push(t):e[l]=[t]})),e.project=Se.value,G.handleFilterSearch(ie.value,e)};let Ee=Z.task;void 0!==Ee&&""!==Ee&&He.value.push(`task=${Ee}`),Ve(),s((()=>G.dynamicTags),(e=>{He.value=e?[...e]:[],Ve()}),{immediate:!1});const $e=k,Fe=o(G.statisticsHidden),Te=()=>{location.reload()};return(a,l)=>(i(),n(g,null,[r(d(e),null,{default:p((()=>[r(d(C),{class:"row-bg",gutter:20},{default:p((()=>[r(d(S),{span:6},{default:p((()=>[r(d(T),{modelValue:ie.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ie.value=e),"fetch-suggestions":we,placeholder:d(X)("form.input"),popperClass:"my-autocomplete",onSelect:ke,style:{width:"100%"}},{append:p((()=>[r(d(u),{onClick:oe,text:"",class:"icon-button",style:{display:"contents"}},{default:p((()=>[r(d(c),{icon:d(re)},null,8,["icon"])])),_:1})])),default:p((({item:e})=>[m("span",K,v(e.keyword||e.operator),1),m("span",N,v(e.explain||e.meaning),1)])),_:1},8,["modelValue","placeholder"])])),_:1}),r(d(S),{span:1.5},{default:p((()=>[r(d(u),{type:"primary",icon:d(ne),onClick:l[1]||(l[1]=e=>a.$props.handleSearch(ie.value))},{default:p((()=>[f(v(d(X)("form.input")),1)])),_:1},8,["icon"])])),_:1}),r(d(S),{span:1.5},{default:p((()=>[r(d(u),{type:"primary",onClick:ve,icon:d(de)},{default:p((()=>[f(v(d(X)("asset.export")),1)])),_:1},8,["icon"])])),_:1}),r(d(S),{span:4},{default:p((()=>[r(d(z),{loading:Ce.value,modelValue:Se.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Se.value=e),data:a.$props.projectList,placeholder:d(X)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["loading","modelValue","data","placeholder"])])),_:1}),r(d(S),{span:1.5,xs:1.5,sm:1.5,md:1.5},{default:p((()=>[r(d(L),{trigger:"click"},{dropdown:p((()=>[r(d(U),null,{default:p((()=>[r(d(D),{icon:d(ce),onClick:ge},{default:p((()=>[f(v(d(X)("common.delete")),1)])),_:1},8,["icon"])])),_:1})])),default:p((()=>[r(d(u),{plain:"",class:"custom-button align-bottom"},{default:p((()=>[f(v(d(X)("common.operation"))+" ",1),r(d(c),{class:"el-icon--right"},{default:p((()=>[r(d(pe))])),_:1})])),_:1})])),_:1})])),_:1}),r(d(S),{span:1,style:{display:"flex","align-items":"center"}},{default:p((()=>[r(d(L),null,{dropdown:p((()=>[r(d(U),null,{default:p((()=>[(i(!0),n(g,null,h(a.crudSchemas,((e,a)=>(i(),y(d(D),{key:a},{default:p((()=>["selection"!=e.field?(i(),n("div",B,[m("span",R,v(e.label),1),r(d(I),{size:"small",modelValue:e.hidden,"onUpdate:modelValue":a=>e.hidden=a,"active-value":!1,"inactive-value":!0,onChange:a=>(e=>{$e("update-column-visibility",{field:e.field,hidden:e.hidden})})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):_("",!0)])),_:2},1024)))),128)),"asset"==a.$props.index?(i(),y(d(D),{key:0},{default:p((()=>[m("span",P,v(d(X)("asset.Chart")),1),r(d(I),{size:"small",modelValue:Fe.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Fe.value=e),"active-value":!1,"inactive-value":!0,onChange:l[4]||(l[4]=e=>a.changeStatisticsHidden(Fe.value))},null,8,["modelValue"])])),_:1})):_("",!0),r(d(D),{divided:""},{default:p((()=>[r(d(u),{style:{width:"100%"},type:"primary",onClick:Te},{default:p((()=>[f("Save")])),_:1})])),_:1})])),_:1})])),default:p((()=>[m("div",q,[r(d(x),{icon:"ant-design:setting-outlined",class:"cursor-pointer"})])])),_:1})])),_:1}),r(d(S),{span:2,xs:2,sm:2,md:2},{default:p((()=>["SensitiveResult"==a.index?(i(),y(d(u),{key:0,type:"success",onClick:a.$props.openAggregation,icon:d(ue)},{default:p((()=>[f(v(d(X)("project.aggregation")),1)])),_:1},8,["onClick","icon"])):_("",!0)])),_:1})])),_:1}),r(d(C),{style:{"margin-top":"10px"}},{default:p((()=>[r(d(S),{span:24},{default:p((()=>[m("div",M,[(i(!0),n(g,null,h(He.value,(e=>(i(),y(d(E),{key:e,closable:"","disable-transitions":!1,type:"info",size:"small",onClose:a=>function(e){G.handleClose&&G.handleClose(e)}(e)},{default:p((()=>[f(v(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1})])),_:1})])),_:1}),r(d(A),{modelValue:te.value,"onUpdate:modelValue":l[5]||(l[5]=e=>te.value=e),title:d(X)("common.querysyntax"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:p((()=>[r(d(C),null,{default:p((()=>[r(d(S),null,{default:p((()=>[r(d($),{tag:"b",size:"small"},{default:p((()=>[f(v(d(X)("searchHelp.operator")),1)])),_:1}),r(d(F),{direction:"vertical"}),r(d($),{size:"small",type:"danger"},{default:p((()=>[f(v(d(X)("searchHelp.notice")),1)])),_:1})])),_:1}),r(d(S),{style:{"margin-top":"10px"}},{default:p((()=>[r(d(H),{headerCellStyle:se,data:d(le)},{default:p((()=>[r(d(V),{prop:"operator",label:d(X)("searchHelp.operator"),width:"300"},null,8,["label"]),r(d(V),{prop:"meaning",label:d(X)("searchHelp.meaning")},null,8,["label"])])),_:1},8,["data"])])),_:1}),r(d(S),{style:{"margin-top":"15px"}},{default:p((()=>[r(d($),{tag:"b",size:"small"},{default:p((()=>[f(v(d(X)("searchHelp.keywords")),1)])),_:1})])),_:1}),r(d(S),{style:{"margin-top":"10px"}},{default:p((()=>[r(d(H),{headerCellStyle:se,data:Q},{default:p((()=>[r(d(V),{prop:"keyword",label:d(X)("searchHelp.keywords")},null,8,["label"]),r(d(V),{prop:"example",label:d(X)("searchHelp.example")},null,8,["label"]),r(d(V),{prop:"explain",label:d(X)("searchHelp.explain")},null,8,["label"])])),_:1},8,["data"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"]),r(d(A),{modelValue:me.value,"onUpdate:modelValue":l[6]||(l[6]=e=>me.value=e),title:d(X)("asset.export"),center:"","max-height":"300",width:"auto",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:p((()=>[r(W,{index:a.$props.index,searchParams:ie.value},null,8,["index","searchParams"])])),_:1},8,["modelValue","title"])],64))}}),[["__scopeId","data-v-0b536bd0"]]);export{X as default};
