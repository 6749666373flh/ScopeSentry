import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BgCcO80c.js";import{d as a,s as l,r as t,R as o,o as s,c as r,e as i,w as n,a as p,y as u,t as c,M as d,f as m,aa as v,i as f,j as g,F as h,S as _,l as y,J as x,Q as j,_ as b}from"./index-B4Nyjh3H.js";import{a as w,E as k}from"./el-col-ChTZtubL.js";import{E as C,a as H}from"./el-table-column-D5fUDOpn.js";import"./el-checkbox-DAPJr8Xi.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-DBt0ZFPB.js";import{E}from"./el-tag-DS_6W9-f.js";import{E as V}from"./el-text-D_MjvMVh.js";import{E as S}from"./el-divider-C1wqG4VS.js";import{E as T,a as F}from"./el-tree-select-C06mNOXK.js";import{E as L,b as $,a as z}from"./el-dropdown-item-BheZ-il5.js";import"./el-select-ErNzBCXo.js";import{_ as D}from"./Dialog.vue_vue_type_style_index_0_lang-bTolZCeI.js";import{u as A}from"./useIcon-DitchYFS.js";import{_ as W}from"./exportData.vue_vue_type_script_setup_true_lang-wnjOG-ih.js";import{r as q}from"./index-BS_iuBaF.js";import"./el-card-wk8kGoMw.js";import"./index-ThnV7dxG.js";import"./isEqual-DFD3TClT.js";import"./debounce-4WtFbZlf.js";import"./isArrayLikeObject-CWayLN3s.js";import"./raf-jjs8tbGM.js";import"./index-CdW5lxxY.js";import"./useInput-Drsa8fv-.js";import"./castArray-BrlE0VBR.js";import"./refs-CGmkSrb7.js";import"./el-tab-pane-Dsdbtla6.js";import"./el-form-DDCfLIJB.js";import"./el-radio-group-exGM2d1B.js";import"./el-space-D7hoWy8Y.js";import"./index-CdbOSPly.js";import"./Table.vue_vue_type_script_lang-DkXax4KK.js";import"./el-image-viewer-CLYRUyY9.js";import"./tsxHelper-TQdELaO0.js";import"./index-xQ3iUQKd.js";import"./useTable-CG-SPGP0.js";const I={style:{float:"left"}},R={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},U={class:"flex gap-2"},K=b(a({__name:"Csearch",props:{getList:{type:Function},handleSearch:{type:Function},searchKeywordsData:{},index:{},getElTableExpose:{type:Function},handleFilterSearch:{type:Function},projectList:{},dynamicTags:{},handleClose:{type:Function},openAggregation:{type:Function}},setup(a){const{t:b}=y(),K=a,P=l([...K.searchKeywordsData]),B={keyword:"task",example:'task=="test"',explain:b("searchHelp.taskName")};P.push(B);const M=[{operator:"=",meaning:b("searchHelp.like"),value:'=""'},{operator:"!=",meaning:b("searchHelp.notIn"),value:'!=""'},{operator:"==",meaning:b("searchHelp.equal"),value:'==""'}],N=[{operator:"&&",meaning:b("searchHelp.and"),value:"&&",logic:"1"},{operator:"||",meaning:b("searchHelp.or"),value:"||",logic:"1"},{operator:"()",meaning:b("searchHelp.brackets"),value:"()",logic:"1"}],O=M.concat(N),J=t(!1),Q=()=>{J.value=!0};function X(){return{background:"var(--el-fill-color-light)"}}const G=t(""),Y=A({icon:"iconoir:search"}),Z=A({icon:"tdesign:chat-bubble-help"}),ee=A({icon:"ri:arrow-drop-down-line"}),ae=A({icon:"ph:export-light"}),le=A({icon:"carbon:data-vis-1"}),te=A({icon:"openmoji:delete"}),oe=t(!1),se=()=>{oe.value=!0},re=t([]),ie=async()=>{x.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{const e=await K.getElTableExpose(),a=(null==e?void 0:e.getSelectionRows())||[];re.value=a.map((e=>e.id)),await q(re.value,K.index),K.getList()})).catch((()=>{j({type:"info",message:"Delete canceled"})}))},ne=t(""),pe=t(!1),ue=t(!1);let ce=t(!0),de=t(!1),me=t(!1);const ve=(e,a)=>{if(ne.value=e,""==e&&(ce.value=!0,me.value=!1,de.value=!1),ce.value){me.value&&(e=e.replace(ne.value,"").trim());a(P.filter((a=>a.keyword.toLowerCase().includes(e.toLowerCase()))))}else if(de.value){const l=e.replace(ne.value,"").trim();a(M.filter((e=>e.operator.includes(l))))}else if(me.value&&e.endsWith(" ")){const l=e.replace(G.value,"").trim();a(N.filter((e=>e.operator.includes(l))))}else a([])},fe=e=>{if(e.keyword){let a="";a=me.value?ne.value+e.keyword:e.keyword,ne.value=a,G.value=a,pe.value=!0,ce.value=!1,de.value=!0}else e.logic?(G.value=`${ne.value}${e.value}`,ne.value=G.value,ce.value=!0):(G.value=`${ne.value}${e.value}`,ne.value=G.value,ue.value=!0,de.value=!1,me.value=!0)},ge=t(!1),he=t([]);o((()=>he.value),(e=>{(async()=>{K.handleFilterSearch(G.value,{project:he.value})})()}));const _e=t(K.dynamicTags?[...K.dynamicTags]:[]);return o((()=>K.dynamicTags),(e=>{_e.value=e?[...e]:[],(()=>{const e={};_e.value.forEach((a=>{const[l,t]=a.split("=");l in e?e[l].push(t):e[l]=[t]})),e.project=he.value,K.handleFilterSearch(G.value,e)})()}),{immediate:!1}),(a,l)=>(s(),r(h,null,[i(p(e),null,{default:n((()=>[i(p(w),{class:"row-bg",gutter:20},{default:n((()=>[i(p(k),{span:8},{default:n((()=>[u(c(p(b)("form.input"))+" ",1),i(p(T),{modelValue:G.value,"onUpdate:modelValue":l[0]||(l[0]=e=>G.value=e),"fetch-suggestions":ve,popperClass:"my-autocomplete",onSelect:fe,style:{width:"90%"}},{append:n((()=>[i(p(d),{onClick:Q,text:"",class:"icon-button",icon:p(Z),style:{display:"contents"}},null,8,["icon"])])),default:n((({item:e})=>[m("span",I,c(e.keyword||e.operator),1),m("span",R,c(e.explain||e.meaning),1)])),_:1},8,["modelValue"])])),_:1}),i(p(k),{span:1.5},{default:n((()=>[i(p(d),{type:"primary",icon:p(Y),onClick:l[1]||(l[1]=e=>a.$props.handleSearch(G.value))},{default:n((()=>[u(c(p(b)("form.input")),1)])),_:1},8,["icon"])])),_:1}),i(p(k),{span:1.5},{default:n((()=>[i(p(d),{type:"primary",onClick:se,icon:p(ae)},{default:n((()=>[u(c(p(b)("asset.export")),1)])),_:1},8,["icon"])])),_:1}),i(p(k),{span:4},{default:n((()=>[u(c(p(b)("project.project"))+": ",1),i(p(F),{loading:ge.value,style:{width:"80%"},modelValue:he.value,"onUpdate:modelValue":l[2]||(l[2]=e=>he.value=e),data:a.$props.projectList,multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["loading","modelValue","data"])])),_:1}),i(p(k),{span:1.5,xs:1.5,sm:1.5,md:1.5},{default:n((()=>[i(p(L),{trigger:"click"},{dropdown:n((()=>[i(p($),null,{default:n((()=>[i(p(z),{icon:p(te),onClick:ie},{default:n((()=>[u(c(p(b)("common.delete")),1)])),_:1},8,["icon"])])),_:1})])),default:n((()=>[i(p(d),{plain:"",class:"custom-button align-bottom"},{default:n((()=>[u(c(p(b)("common.operation"))+" ",1),i(p(v),{class:"el-icon--right"},{default:n((()=>[i(p(ee))])),_:1})])),_:1})])),_:1})])),_:1}),i(p(k),{span:2,xs:2,sm:2,md:2},{default:n((()=>["SensitiveResult"==a.index?(s(),f(p(d),{key:0,type:"success",onClick:a.$props.openAggregation,icon:p(le)},{default:n((()=>[u(c(p(b)("project.aggregation")),1)])),_:1},8,["onClick","icon"])):g("",!0)])),_:1})])),_:1}),i(p(w),{style:{"margin-top":"10px",left:"30px"}},{default:n((()=>[i(p(k),{span:24},{default:n((()=>[m("div",U,[(s(!0),r(h,null,_(_e.value,(e=>(s(),f(p(E),{key:e,closable:"","disable-transitions":!1,type:"info",size:"small",onClose:a=>function(e){K.handleClose&&K.handleClose(e)}(e)},{default:n((()=>[u(c(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1})])),_:1})])),_:1}),i(p(D),{modelValue:J.value,"onUpdate:modelValue":l[3]||(l[3]=e=>J.value=e),title:p(b)("common.querysyntax"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:n((()=>[i(p(w),null,{default:n((()=>[i(p(k),null,{default:n((()=>[i(p(V),{tag:"b",size:"small"},{default:n((()=>[u(c(p(b)("searchHelp.operator")),1)])),_:1}),i(p(S),{direction:"vertical"}),i(p(V),{size:"small",type:"danger"},{default:n((()=>[u(c(p(b)("searchHelp.notice")),1)])),_:1})])),_:1}),i(p(k),{style:{"margin-top":"10px"}},{default:n((()=>[i(p(C),{headerCellStyle:X,data:p(O)},{default:n((()=>[i(p(H),{prop:"operator",label:p(b)("searchHelp.operator"),width:"300"},null,8,["label"]),i(p(H),{prop:"meaning",label:p(b)("searchHelp.meaning")},null,8,["label"])])),_:1},8,["data"])])),_:1}),i(p(k),{style:{"margin-top":"15px"}},{default:n((()=>[i(p(V),{tag:"b",size:"small"},{default:n((()=>[u(c(p(b)("searchHelp.keywords")),1)])),_:1})])),_:1}),i(p(k),{style:{"margin-top":"10px"}},{default:n((()=>[i(p(C),{headerCellStyle:X,data:P},{default:n((()=>[i(p(H),{prop:"keyword",label:p(b)("searchHelp.keywords")},null,8,["label"]),i(p(H),{prop:"example",label:p(b)("searchHelp.example")},null,8,["label"]),i(p(H),{prop:"explain",label:p(b)("searchHelp.explain")},null,8,["label"])])),_:1},8,["data"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"]),i(p(D),{modelValue:oe.value,"onUpdate:modelValue":l[4]||(l[4]=e=>oe.value=e),title:p(b)("asset.export"),center:"","max-height":"300",width:"auto",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:n((()=>[i(W,{index:a.$props.index,searchParams:G.value},null,8,["index","searchParams"])])),_:1},8,["modelValue","title"])],64))}}),[["__scopeId","data-v-8d5ef7f7"]]);export{K as default};
