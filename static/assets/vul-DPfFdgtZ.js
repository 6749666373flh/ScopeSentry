import{d as e,r as t,N as l,e as a,$ as i,O as o,R as s,I as n,V as r,H as u,S as p,W as d,Q as c,o as m,c as v,a as g,w as f,X as h,t as b,f as x,Y as y,l as j,aq as _,_ as w}from"./index-DI3N4DDI.js";import{u as S}from"./useTable-4dOfrcPy.js";import{E as V}from"./el-card-CCD9TSoE.js";import{E as k}from"./el-pagination-D9CRNaLC.js";import{E as L}from"./el-tag-CQw-CsVu.js";import{E,a as R}from"./el-select-D7UeB03W.js";import"./el-popper-B9xEIKf9.js";import{E as C,a as H}from"./el-col-BEOU1v5m.js";import{E as U,a as z}from"./el-descriptions-item-BFo9_l01.js";import{E as T}from"./el-text-CnhbgniK.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-CB0H7wcP.js";import{_ as I}from"./Table.vue_vue_type_script_lang-DW90GZY1.js";import{u as O}from"./useCrudSchemas-BJEiSmxE.js";import{r as q}from"./index-C6HOZMRK.js";import D from"./Csearch-DAEZdcF9.js";import{u as P,a as $,d as A}from"./index-DRovhEPI.js";import{_ as M}from"./Detail.vue_vue_type_script_setup_true_lang-CWP2eRsT.js";import{b as N}from"./index-UQFJYCAD.js";import"./index-CMEhF4Ek.js";import"./strings-BdiANRsY.js";import"./useInput-BJ8eDgPK.js";import"./debounce-C9rnDQym.js";import"./refs-CW4D39DO.js";import"./el-table-column-BeBSjzmc.js";import"./el-checkbox-Df5USE6T.js";import"./isArrayLikeObject-jQ3Se21q.js";import"./raf-Bj5h1035.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-image-viewer-CL3Ie8Xn.js";import"./el-empty-CMQh976C.js";import"./tsxHelper-BxOdfN3f.js";import"./el-dropdown-item-CS2CnWdl.js";import"./castArray-CHejV_tG.js";import"./index-DUf0N3jf.js";import"./tree-BfZhwLPs.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-DTW7xH19.js";import"./el-divider-CWUgdrsM.js";import"./el-tree-select-Zdw-Fhnk.js";import"./index-sTYlWcol.js";/* empty css                */import"./el-switch-THXGS1Q1.js";import"./useIcon-DOTDo2y0.js";import"./exportData.vue_vue_type_script_setup_true_lang-DGYR1VMF.js";import"./el-tab-pane-BVQybLAS.js";import"./el-form-Bgr1UCE8.js";import"./el-radio-group-DxpMR3lM.js";import"./el-space-ByVodLsT.js";import"./el-virtual-list-GBZDlwu7.js";import"./el-select-v2-Cbe3chUG.js";import"./index-35bh6_va.js";const F={style:{whiteSpace:"pre-line",width:"500px"}},K={style:{whiteSpace:"pre-line"}};function J(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!y(e)}const B=w(e({__name:"vul",props:{projectList:{}},setup(e){const{t:y}=j(),w=[{keyword:"url",example:'url="http://example.com"',explain:y("searchHelp.url")},{keyword:"vulname",example:'vulname="nginxwebui-runcmd-rce"',explain:y("searchHelp.vulname")},{keyword:"level",example:'level="info"',explain:y("searchHelp.level")},{keyword:"matched",example:'matched="https://example.com"',explain:y("searchHelp.matched")},{keyword:"request",example:'request="cmd=whoami"',explain:y("searchHelp.vulRequest")},{keyword:"response",example:'response="root"',explain:y("searchHelp.response")},{keyword:"project",example:'project="Hackerone"',explain:y("searchHelp.project")}],B=t(""),G=e=>{B.value=e,pe()},X=l({}),Y=l([{field:"selection",type:"selection",minWidth:"55"},{field:"index",label:y("tableDemo.index"),type:"index",minWidth:55},{field:"url",label:"URL",minWidth:100},{field:"vulnerability",label:"Vulnerability",minWidth:120},{field:"level",label:"Level",minWidth:100,columnKey:"level",formatter:(e,t,l)=>{if(null==l)return a("div",null,null);let o="",s="";return"critical"===l?(o="red",s=y("poc.critical")):"high"===l?(o="orange",s=y("poc.high")):"medium"===l?(o="yellow",s=y("poc.medium")):"low"===l?(o="blue",s=y("poc.low")):"info"===l?(o="green",s=y("poc.info")):"unknown"===l&&(o="gray",s=y("poc.unknown")),a(H,{gutter:20,style:"width: 80%"},{default:()=>[a(C,{span:1},{default:()=>[a(i,{icon:"clarity:circle-solid",color:o},null)]}),a(C,{span:5},{default:()=>[a(T,{type:"info"},J(s)?s:{default:()=>[s]})]})]})},filters:[{text:y("poc.critical"),value:"critical"},{text:y("poc.high"),value:"high"},{text:y("poc.medium"),value:"medium"},{text:y("poc.low"),value:"low"},{text:y("poc.info"),value:"info"},{text:y("poc.unknown"),value:"unknown"}]},{field:"matched",label:"Matched",minWidth:150},{field:"status",label:y("common.state"),minWidth:100,columnKey:"status",formatter:(e,t,l)=>{let i;null==e.status&&(e.status=1);const o=[{value:1,label:y("common.unprocessed")},{value:2,label:y("common.processing")},{value:3,label:y("common.ignored")},{value:4,label:y("common.suspected")},{value:5,label:y("common.confirmed")}];return a(R,{modelValue:e.status,"onUpdate:modelValue":async t=>{try{e.status=t,P(e.id,"vulnerability",t)}catch(l){}}},J(i=o.map((e=>a(E,{key:e.value,label:e.label,value:e.value},null))))?i:{default:()=>[i]})},filters:[{text:y("common.unprocessed"),value:1},{text:y("common.processing"),value:2},{text:y("common.ignored"),value:3},{text:y("common.suspected"),value:4},{text:y("common.confirmed"),value:5}]},{field:"tags",label:"TAG",fit:"true",formatter:(e,l,a)=>{null==a&&(a=[]),X[e.id]||(X[e.id]={inputVisible:!1,inputValue:"",inputRef:t(null)});const i=X[e.id],r=async()=>{i.inputValue&&(a.push(i.inputValue),$(e.id,Q,i.inputValue)),i.inputVisible=!1,i.inputValue=""};return o(H,{},(()=>[...a.map((t=>o(C,{span:24,key:t},(()=>[o("div",{onClick:e=>((e,t)=>{e.target.classList.contains("el-tag__close")||we("tags",t)})(e,t)},[o(L,{closable:!0,onClose:()=>(async t=>{const l=a.indexOf(t);l>-1&&a.splice(l,1),A(e.id,Q,t)})(t)},(()=>t))])])))),o(C,{span:24},i.inputVisible?()=>o(s,{ref:i.inputRef,modelValue:i.inputValue,"onUpdate:modelValue":e=>i.inputValue=e,class:"w-20",size:"small",onKeyup:e=>{"Enter"===e.key&&r()},onBlur:r}):()=>o(n,{class:"button-new-tag",size:"small",onClick:()=>(i.inputVisible=!0,void _((()=>{})))},(()=>"+ New Tag")))]))},minWidth:"130"},{field:"time",label:y("asset.time"),minWidth:200},{field:"action",label:y("tableDemo.action"),formatter:(e,t,l)=>{let i;return a(p,null,[a(r,{type:"primary",onClick:()=>be(e)},J(i=y("asset.detail"))?i:{default:()=>[i]}),a(r,{type:"success",onClick:()=>Le(e.vulnid)},{default:()=>[u("POC")]})])},minWidth:100}]);let Q="vulnerability";Y.forEach((e=>{e.hidden=e.hidden??!1}));let Z=t(!1);const ee=({field:e,hidden:t})=>{const l=Y.findIndex((t=>t.field===e));-1!==l&&(Y[l].hidden=t),(()=>{const e=Y.reduce(((e,t)=>(e[t.field]=t.hidden,e)),{});e.statisticsHidden=Z.value,localStorage.setItem(`columnConfig_${Q}`,JSON.stringify(e))})()};(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${Q}`)||"{}");Y.forEach((t=>{void 0!==e[t.field]&&"select"!=t.field&&(t.hidden=e[t.field])})),Z.value=e.statisticsHidden})();const{allSchemas:te}=O(Y),{tableRegister:le,tableState:ae,tableMethods:ie}=S({fetchDataApi:async()=>{const{currentPage:e,pageSize:t}=ae,l=await((e,t,l,a)=>q.post({url:"/api/vul/data",data:{search:e,pageIndex:t,pageSize:l,filter:a}}))(B.value,e.value,t.value,xe);return{list:l.data.list,total:l.data.total}},immediate:!1}),{loading:oe,dataList:se,total:ne,currentPage:re,pageSize:ue}=ae,{getList:pe,getElTableExpose:de}=ie;function ce(){return{background:"var(--el-fill-color-light)"}}ue.value=20,d((()=>{ve(),window.addEventListener("resize",ve)}));const me=t(0),ve=()=>{const e=window.innerHeight||document.documentElement.clientHeight;me.value=.7*e},ge=l({URL:"",Vulnerability:"",Level:"",Matched:"",Time:"",Request:"",Response:""}),fe=t(""),he=t(!1),be=e=>{const t=e.level;fe.value="";let l="";"critical"===t?(fe.value="red",l=y("poc.critical")):"high"===t?(fe.value="orange",l=y("poc.high")):"medium"===t?(fe.value="yellow",l=y("poc.medium")):"low"===t?(fe.value="blue",l=y("poc.low")):"info"===t?(fe.value="green",l=y("poc.info")):"unknown"===t&&(fe.value="gray",l=y("poc.unknown")),ge.Level=l,ge.Vulnerability=e.vulnerability,ge.Matched=e.matched,ge.Time=e.time,ge.URL=e.url,ge.Request=e.request,ge.Response=e.response,he.value=!0},xe=l({}),ye=async e=>{Object.assign(xe,e),pe()},je=(e,t)=>{Object.assign(xe,t),B.value=e,pe()},_e=t([]),we=(e,t)=>{const l=`${e}=${t}`;_e.value=[..._e.value,l]},Se=e=>{if(_e.value){const[t,l]=e.split("=");t in xe&&Array.isArray(xe[t])&&(xe[t]=xe[t].filter((e=>e!==l)),0===xe[t].length&&delete xe[t]),_e.value=_e.value.filter((t=>t!==e))}};let Ve=l({id:"",name:"",level:"",content:"",tags:[]});const ke=t(!1),Le=async e=>{Ve.id="",Ve.name="",Ve.level="",Ve.content="",Ve.tags=[];const t=await N(e);Ve.id=t.data.data.id,Ve.name=t.data.data.name,Ve.level=t.data.data.level,Ve.content=t.data.data.content,Ve.tags=t.data.data.tags,ke.value=!0},Ee=()=>{ke.value=!1};return(e,t)=>{const l=c("ElScrollbar");return m(),v(p,null,[a(D,{getList:g(pe),handleSearch:G,searchKeywordsData:w,index:"vulnerability",getElTableExpose:g(de),handleFilterSearch:je,projectList:e.$props.projectList,crudSchemas:Y,dynamicTags:_e.value,handleClose:Se,onUpdateColumnVisibility:ee},null,8,["getList","getElTableExpose","projectList","crudSchemas","dynamicTags"]),a(g(H),null,{default:f((()=>[a(g(C),null,{default:f((()=>[a(g(V),null,{default:f((()=>[a(g(I),{pageSize:g(ue),"onUpdate:pageSize":t[0]||(t[0]=e=>h(ue)?ue.value=e:null),currentPage:g(re),"onUpdate:currentPage":t[1]||(t[1]=e=>h(re)?re.value=e:null),columns:g(te).tableColumns,data:g(se),stripe:"",border:!0,"max-height":me.value,loading:g(oe),resizable:!0,onRegister:g(le),onFilterChange:ye,headerCellStyle:ce,style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"}},null,8,["pageSize","currentPage","columns","data","max-height","loading","onRegister"])])),_:1})])),_:1}),a(g(C),{":span":24},{default:f((()=>[a(g(V),null,{default:f((()=>[a(g(k),{pageSize:g(ue),"onUpdate:pageSize":t[2]||(t[2]=e=>h(ue)?ue.value=e:null),currentPage:g(re),"onUpdate:currentPage":t[3]||(t[3]=e=>h(re)?re.value=e:null),"page-sizes":[20,50,100,200,500,1e3],layout:"total, sizes, prev, pager, next, jumper",total:g(ne)},null,8,["pageSize","currentPage","total"])])),_:1})])),_:1})])),_:1}),a(g(W),{modelValue:he.value,"onUpdate:modelValue":t[4]||(t[4]=e=>he.value=e),title:g(y)("asset.detail"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},width:"70%","max-height":me.value},{default:f((()=>[a(g(U),{border:!0,column:2},{default:f((()=>[a(g(z),{label:"URL"},{default:f((()=>[u(b(ge.URL),1)])),_:1}),a(g(z),{label:"Level",width:"100"},{default:f((()=>[a(g(i),{icon:"clarity:circle-solid",color:fe.value},null,8,["color"]),a(g(T),{type:"info"},{default:f((()=>[u(b(ge.Level),1)])),_:1})])),_:1}),a(g(z),{label:"Vulnerability"},{default:f((()=>[u(b(ge.Vulnerability),1)])),_:1}),a(g(z),{label:"Matched"},{default:f((()=>[u(b(ge.Matched),1)])),_:1}),a(g(z),{label:"Time",span:2},{default:f((()=>[u(b(ge.Time),1)])),_:1}),a(g(z),{label:"Request"},{default:f((()=>[a(l,{"max-height":me.value,"max-width":"maxHeight"},{default:f((()=>[x("div",F,b(ge.Request),1)])),_:1},8,["max-height"])])),_:1}),a(g(z),{label:"Response"},{default:f((()=>[a(l,{"max-height":me.value},{default:f((()=>[x("div",K,b(ge.Response),1)])),_:1},8,["max-height"])])),_:1})])),_:1})])),_:1},8,["modelValue","title","max-height"]),a(g(W),{modelValue:ke.value,"onUpdate:modelValue":t[5]||(t[5]=e=>ke.value=e),title:g(Ve).id?e.$t("common.edit"):e.$t("common.new"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},maxHeight:800},{default:f((()=>[a(M,{closeDialog:Ee,pocForm:g(Ve),getList:g(pe)},null,8,["pocForm","getList"])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-bb124401"]]);export{B as default};
