import{d as e,r as l,s as t,e as a,K as i,v as o,G as s,z as n,C as r,F as u,D as p,N as c,o as d,c as m,a as f,w as h,H as v,y as g,t as b,f as y,I as x,l as j,ai as _,_ as w}from"./index-CN_-6CJN.js";import{u as S}from"./useTable-D4uu-Soo.js";import{E as k}from"./el-card-CNQMmRvy.js";import{E as V}from"./el-pagination-cWAg7nWs.js";import{E}from"./el-tag-C70eRmCH.js";import{E as L,a as R}from"./el-select-D1ImP6MX.js";import"./el-popper-qPvIts7N.js";import{E as C,a as z}from"./el-col-jGixOe2y.js";import{E as H,a as U}from"./el-descriptions-item-BicdRV7J.js";import{E as T}from"./el-text-Bb8H_RHf.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-gBBmaUwO.js";import{_ as I}from"./Table.vue_vue_type_script_lang-B-A-w7yr.js";import{u as q}from"./useCrudSchemas-Di-bMQjR.js";import{r as A}from"./index-CSisi_IG.js";import D from"./Csearch-Dagrp5kp.js";import{u as M,a as N,d as O}from"./index-BiRfkCSs.js";import"./index-C-cnLFau.js";import"./strings-BAothc3L.js";import"./useInput-BQndv-k3.js";import"./debounce-CYJWxmBb.js";import"./refs-BLlp70uH.js";import"./el-table-column-CwOTOpI2.js";import"./el-checkbox-BWglfH5k.js";import"./isArrayLikeObject-B3dE5fSb.js";import"./raf-CKcl9dRI.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-image-viewer-C6bUU2gm.js";import"./el-empty-Dch0KbwO.js";import"./tsxHelper-Bal41hqM.js";import"./el-dropdown-item-C_YpEPv1.js";import"./castArray-B2J6x547.js";import"./index-Cd5cNpU-.js";import"./tree-BfZhwLPs.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-ByRQd7bd.js";import"./el-divider-UM5pYHfY.js";import"./el-tree-select-CLQSZiq_.js";import"./index-BakKIM4W.js";import"./el-switch-C_vE8S4c.js";import"./useIcon-CoAv5gAq.js";import"./exportData.vue_vue_type_script_setup_true_lang-BD7aTcXR.js";import"./el-tab-pane-Cb5dGpe_.js";import"./el-form-gAlh6c2U.js";import"./el-radio-group-cVqelweb.js";import"./el-space-vXK55lKA.js";const P={style:{whiteSpace:"pre-line",width:"500px"}},F={style:{whiteSpace:"pre-line"}};function K(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!x(e)}const $=w(e({__name:"vul",props:{projectList:{}},setup(e){const{t:x}=j(),w=[{keyword:"url",example:'url="http://example.com"',explain:x("searchHelp.url")},{keyword:"vulname",example:'vulname="nginxwebui-runcmd-rce"',explain:x("searchHelp.vulname")},{keyword:"level",example:'level="info"',explain:x("searchHelp.level")},{keyword:"matched",example:'matched="https://example.com"',explain:x("searchHelp.matched")},{keyword:"request",example:'request="cmd=whoami"',explain:x("searchHelp.vulRequest")},{keyword:"response",example:'response="root"',explain:x("searchHelp.response")},{keyword:"project",example:'project="Hackerone"',explain:x("searchHelp.project")}],$=l(""),J=e=>{$.value=e,re()},B=t({}),G=t([{field:"selection",type:"selection",minWidth:"55"},{field:"index",label:x("tableDemo.index"),type:"index",minWidth:55},{field:"url",label:"URL",minWidth:100},{field:"vulnerability",label:"Vulnerability",minWidth:120},{field:"level",label:"Level",minWidth:100,columnKey:"level",formatter:(e,l,t)=>{if(null==t)return a("div",null,null);let o="",s="";return"critical"===t?(o="red",s=x("poc.critical")):"high"===t?(o="orange",s=x("poc.high")):"medium"===t?(o="yellow",s=x("poc.medium")):"low"===t?(o="blue",s=x("poc.low")):"info"===t?(o="green",s=x("poc.info")):"unknown"===t&&(o="gray",s=x("poc.unknown")),a(z,{gutter:20,style:"width: 80%"},{default:()=>[a(C,{span:1},{default:()=>[a(i,{icon:"clarity:circle-solid",color:o},null)]}),a(C,{span:5},{default:()=>[a(T,{type:"info"},K(s)?s:{default:()=>[s]})]})]})},filters:[{text:x("poc.critical"),value:"critical"},{text:x("poc.high"),value:"high"},{text:x("poc.medium"),value:"medium"},{text:x("poc.low"),value:"low"},{text:x("poc.info"),value:"info"},{text:x("poc.unknown"),value:"unknown"}]},{field:"matched",label:"Matched",minWidth:150},{field:"status",label:x("common.state"),minWidth:100,columnKey:"status",formatter:(e,l,t)=>{let i;null==e.status&&(e.status=1);const o=[{value:1,label:x("common.unprocessed")},{value:2,label:x("common.processing")},{value:3,label:x("common.ignored")},{value:4,label:x("common.suspected")},{value:5,label:x("common.confirmed")}];return a(R,{modelValue:e.status,"onUpdate:modelValue":async l=>{try{e.status=l,M(e.id,"vulnerability",l)}catch(t){}}},K(i=o.map((e=>a(L,{key:e.value,label:e.label,value:e.value},null))))?i:{default:()=>[i]})},filters:[{text:x("common.unprocessed"),value:1},{text:x("common.processing"),value:2},{text:x("common.ignored"),value:3},{text:x("common.suspected"),value:4},{text:x("common.confirmed"),value:5}]},{field:"tags",label:"TAG",fit:"true",formatter:(e,t,a)=>{null==a&&(a=[]),B[e.id]||(B[e.id]={inputVisible:!1,inputValue:"",inputRef:l(null)});const i=B[e.id],r=async()=>{i.inputValue&&(a.push(i.inputValue),N(e.id,X,i.inputValue)),i.inputVisible=!1,i.inputValue=""};return o(z,{},(()=>[...a.map((l=>o(C,{span:24,key:l},(()=>[o("div",{onClick:e=>((e,l)=>{e.target.classList.contains("el-tag__close")||je("tags",l)})(e,l)},[o(E,{closable:!0,onClose:()=>(async l=>{const t=a.indexOf(l);t>-1&&a.splice(t,1),O(e.id,X,l)})(l)},(()=>l))])])))),o(C,{span:24},i.inputVisible?()=>o(s,{ref:i.inputRef,modelValue:i.inputValue,"onUpdate:modelValue":e=>i.inputValue=e,class:"w-20",size:"small",onKeyup:e=>{"Enter"===e.key&&r()},onBlur:r}):()=>o(n,{class:"button-new-tag",size:"small",onClick:()=>(i.inputVisible=!0,void _((()=>{})))},(()=>"+ New Tag")))]))},minWidth:"130"},{field:"time",label:x("asset.time"),minWidth:200},{field:"action",label:x("tableDemo.action"),formatter:(e,l,t)=>{let i;return a(u,null,[a(r,{type:"primary",onClick:()=>ve(e)},K(i=x("asset.detail"))?i:{default:()=>[i]})])},minWidth:100}]);let X="vulnerability";G.forEach((e=>{e.hidden=e.hidden??!1}));let Z=l(!1);const Q=({field:e,hidden:l})=>{const t=G.findIndex((l=>l.field===e));-1!==t&&(G[t].hidden=l),(()=>{const e=G.reduce(((e,l)=>(e[l.field]=l.hidden,e)),{});e.statisticsHidden=Z.value,localStorage.setItem(`columnConfig_${X}`,JSON.stringify(e))})()};(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${X}`)||"{}");G.forEach((l=>{void 0!==e[l.field]&&"select"!=l.field&&(l.hidden=e[l.field])})),Z.value=e.statisticsHidden})();const{allSchemas:Y}=q(G),{tableRegister:ee,tableState:le,tableMethods:te}=S({fetchDataApi:async()=>{const{currentPage:e,pageSize:l}=le,t=await((e,l,t,a)=>A.post({url:"/api/vul/data",data:{search:e,pageIndex:l,pageSize:t,filter:a}}))($.value,e.value,l.value,ge);return{list:t.data.list,total:t.data.total}},immediate:!1}),{loading:ae,dataList:ie,total:oe,currentPage:se,pageSize:ne}=le,{getList:re,getElTableExpose:ue}=te;function pe(){return{background:"var(--el-fill-color-light)"}}ne.value=20,p((()=>{de(),window.addEventListener("resize",de)}));const ce=l(0),de=()=>{const e=window.innerHeight||document.documentElement.clientHeight;ce.value=.7*e},me=t({URL:"",Vulnerability:"",Level:"",Matched:"",Time:"",Request:"",Response:""}),fe=l(""),he=l(!1),ve=e=>{const l=e.level;fe.value="";let t="";"critical"===l?(fe.value="red",t=x("poc.critical")):"high"===l?(fe.value="orange",t=x("poc.high")):"medium"===l?(fe.value="yellow",t=x("poc.medium")):"low"===l?(fe.value="blue",t=x("poc.low")):"info"===l?(fe.value="green",t=x("poc.info")):"unknown"===l&&(fe.value="gray",t=x("poc.unknown")),me.Level=t,me.Vulnerability=e.vulnerability,me.Matched=e.matched,me.Time=e.time,me.URL=e.url,me.Request=e.request,me.Response=e.response,he.value=!0},ge=t({}),be=async e=>{Object.assign(ge,e),re()},ye=(e,l)=>{Object.assign(ge,l),$.value=e,re()},xe=l([]),je=(e,l)=>{const t=`${e}=${l}`;xe.value=[...xe.value,t]},_e=e=>{if(xe.value){const[l,t]=e.split("=");l in ge&&Array.isArray(ge[l])&&(ge[l]=ge[l].filter((e=>e!==t)),0===ge[l].length&&delete ge[l]),xe.value=xe.value.filter((l=>l!==e))}};return(e,l)=>{const t=c("ElScrollbar");return d(),m(u,null,[a(D,{getList:f(re),handleSearch:J,searchKeywordsData:w,index:"vulnerability",getElTableExpose:f(ue),handleFilterSearch:ye,projectList:e.$props.projectList,crudSchemas:G,dynamicTags:xe.value,handleClose:_e,onUpdateColumnVisibility:Q},null,8,["getList","getElTableExpose","projectList","crudSchemas","dynamicTags"]),a(f(z),null,{default:h((()=>[a(f(C),null,{default:h((()=>[a(f(k),null,{default:h((()=>[a(f(I),{pageSize:f(ne),"onUpdate:pageSize":l[0]||(l[0]=e=>v(ne)?ne.value=e:null),currentPage:f(se),"onUpdate:currentPage":l[1]||(l[1]=e=>v(se)?se.value=e:null),columns:f(Y).tableColumns,data:f(ie),stripe:"",border:!0,"max-height":ce.value,loading:f(ae),resizable:!0,onRegister:f(ee),onFilterChange:be,headerCellStyle:pe,style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"}},null,8,["pageSize","currentPage","columns","data","max-height","loading","onRegister"])])),_:1})])),_:1}),a(f(C),{":span":24},{default:h((()=>[a(f(k),null,{default:h((()=>[a(f(V),{pageSize:f(ne),"onUpdate:pageSize":l[2]||(l[2]=e=>v(ne)?ne.value=e:null),currentPage:f(se),"onUpdate:currentPage":l[3]||(l[3]=e=>v(se)?se.value=e:null),"page-sizes":[20,50,100,200,500,1e3],layout:"total, sizes, prev, pager, next, jumper",total:f(oe)},null,8,["pageSize","currentPage","total"])])),_:1})])),_:1})])),_:1}),a(f(W),{modelValue:he.value,"onUpdate:modelValue":l[4]||(l[4]=e=>he.value=e),title:f(x)("asset.detail"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},width:"70%","max-height":ce.value},{default:h((()=>[a(f(H),{border:!0,column:2},{default:h((()=>[a(f(U),{label:"URL"},{default:h((()=>[g(b(me.URL),1)])),_:1}),a(f(U),{label:"Level",width:"100"},{default:h((()=>[a(f(i),{icon:"clarity:circle-solid",color:fe.value},null,8,["color"]),a(f(T),{type:"info"},{default:h((()=>[g(b(me.Level),1)])),_:1})])),_:1}),a(f(U),{label:"Vulnerability"},{default:h((()=>[g(b(me.Vulnerability),1)])),_:1}),a(f(U),{label:"Matched"},{default:h((()=>[g(b(me.Matched),1)])),_:1}),a(f(U),{label:"Time",span:2},{default:h((()=>[g(b(me.Time),1)])),_:1}),a(f(U),{label:"Request"},{default:h((()=>[a(t,{"max-height":ce.value,"max-width":"maxHeight"},{default:h((()=>[y("div",P,b(me.Request),1)])),_:1},8,["max-height"])])),_:1}),a(f(U),{label:"Response"},{default:h((()=>[a(t,{"max-height":ce.value},{default:h((()=>[y("div",F,b(me.Response),1)])),_:1},8,["max-height"])])),_:1})])),_:1})])),_:1},8,["modelValue","title","max-height"])],64)}}}),[["__scopeId","data-v-06bf88b7"]]);export{$ as default};
