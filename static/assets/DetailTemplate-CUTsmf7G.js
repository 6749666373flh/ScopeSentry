import{d as a,s as e,r as t,O as l,o as s,i as o,w as n,e as i,a as r,G as d,c as u,R as p,F as m,z as c,y as f,ae as b,l as y,L as h,f as v,aH as g,t as F,j,_ as S}from"./index-lnK3vi2u.js";import"./el-tooltip-l0sNRNKZ.js";import{E as w}from"./el-popper-u58bCfVz.js";import{E as _}from"./el-tag-BuYucu0j.js";import{E as P}from"./el-card-Bnv5_xAI.js";import{E as V}from"./el-switch-CNhl8tfg.js";import{a as A,E}from"./el-form-BQdiY2FK.js";import"./el-virtual-list-CdgO8bCm.js";import{E as x}from"./el-select-v2-D41hMSoB.js";import{E as B,a as U}from"./el-col-BaaUI79S.js";import{e as k}from"./index-BllBZMIQ.js";import{b as D}from"./index-Djpn7BGD.js";import{m as L,n as H}from"./index-fMWEXd-N.js";import"./castArray-Vw7lTMUi.js";import"./raf-BAxP01Hz.js";import"./useInput-C2svBfmf.js";import"./index-W8_TjnTK.js";import"./debounce-D1p90kO3.js";import"./strings-D_ONF1MI.js";import"./index-BlMFUDDZ.js";const R={style:{display:"flex","justify-content":"space-between","align-items":"center"}},C=S(a({__name:"DetailTemplate",props:{closeDialog:{type:Function},getList:{type:Function},id:{}},setup(a){const{t:S}=y(),C=a,T=["TargetHandler","SubdomainScan","SubdomainSecurity","PortScanPreparation","PortScan","PortFingerprint","AssetMapping","AssetHandle","URLScan","WebCrawler","URLSecurity","DirScan","VulnerabilityScan"],I=e({}),G=e({}),M=e({}),W=t([]);l((()=>C.id),(async a=>{a?await(async a=>{var e;const t=await H(a);N.value=t.data.name,W.value=t.data.vullist;for(const l of T){G[l]={};const a=(null==(e=t.data)?void 0:e[l])||[],s=await k(l);I[l]=s.data.list.map((e=>({...e,enabled:a.includes(e.hash)||!1}))),G[l]=t.data.Parameters[l]||{}}})(a):await(async()=>{for(const a of T){const e=await k(a);G[a]={},M[a]=[],I[a]=e.data.list.map((e=>(G[a][e.hash]=e.parameter||"",{...e,enabled:!1})))}})()}),{immediate:!0});const z=t(!1),J=async()=>{z.value=!0;const a={};if(""==N.value)return h.error("name 不能为空"),void(z.value=!1);for(const e of T){const t=I[e].filter((a=>a.enabled));a[e]=t.map((a=>a.hash)),a.Parameters=a.Parameters||{},a.Parameters[e]={};for(const l of I[e])G[e][l.hash]&&(a.Parameters[e][l.hash]=G[e][l.hash])}a.name=N.value,a.vullist=W.value,await L(a,C.id),h.success("提交成功"),z.value=!1,C.closeDialog(),C.getList()},K={TargetHandler:"#2243dda6",SubdomainScan:"#FF9B85",SubdomainSecurity:"#FFFFBA",PortScanPreparation:"#BAFFB3",PortScan:"#BAE1FF",AssetMapping:"#e3ffba",URLScan:"#D1BAFF",WebCrawler:"#FFABAB",DirScan:"#3ccde6",VulnerabilityScan:"#FF677D",AssetHandle:"#B2E1FF",PortFingerprint:"#ffb5e4",URLSecurity:"#FFE4BA"},N=t(""),O=e([]);return(async()=>{const a=await D();a.data.list.length>0&&(O.push({value:"All Poc",label:"All Poc"}),a.data.list.forEach((a=>{O.push({value:a.id,label:a.name})})))})(),(a,e)=>(s(),o(r(E),{onSubmit:b(J,["prevent"]),"label-width":"auto"},{default:n((()=>[i(r(A),{label:r(S)("task.templateName")},{default:n((()=>[i(r(d),{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=a=>N.value=a)},null,8,["modelValue"])])),_:1},8,["label"]),(s(),u(m,null,p(T,(a=>v("div",{key:a},[i(r(P),{class:"module-card","body-style":{padding:"20px"},shadow:"always"},{default:n((()=>[v("div",R,[i(r(_),{style:g({backgroundColor:K[a],color:"#000"})},{default:n((()=>[f(F(r(S)(`scanTemplate.${a}`)),1)])),_:2},1032,["style"])]),(s(!0),u(m,null,p(I[a],(t=>(s(),u("div",{key:t.hash},[i(r(A),{label:t.name},{default:n((()=>[i(r(w),{placement:"top",effect:"light",content:t.introduction},{default:n((()=>[i(r(V),{modelValue:t.enabled,"onUpdate:modelValue":a=>t.enabled=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["content"])])),_:2},1032,["label"]),t.enabled&&"ed93b8af6b72fe54a60efdb932cf6fbc"===t.hash?(s(),o(r(A),{key:0,label:r(S)("task.vulList"),prop:"type"},{default:n((()=>[i(r(x),{modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=a=>W.value=a),filterable:"",options:O,placeholder:"Please select vul",style:{width:"80%"},multiple:"","collapse-tags":"","collapse-tags-tooltip":"","tag-type":"info","max-collapse-tags":3},null,8,["modelValue","options"])])),_:1},8,["label"])):j("",!0),t.enabled?(s(),o(r(A),{key:1,label:r(S)("plugin.parameter")},{default:n((()=>[i(r(w),{placement:"top",effect:"light",content:t.help},{default:n((()=>[i(r(d),{modelValue:G[a][t.hash],"onUpdate:modelValue":e=>G[a][t.hash]=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["content"])])),_:2},1032,["label"])):j("",!0)])))),128))])),_:2},1024)]))),64)),i(r(U),null,{default:n((()=>[i(r(B),{span:12,style:{"text-align":"right"}},{default:n((()=>[i(r(c),{type:"primary",onClick:J,loading:z.value},{default:n((()=>[f(" 保存 ")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1}))}}),[["__scopeId","data-v-abaf5c93"]]);export{C as default};
