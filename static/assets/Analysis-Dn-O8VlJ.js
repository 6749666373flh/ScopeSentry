import{P as e,g as a}from"./PanelGroup-gk9ShYXB.js";import{d as t,r as s,s as o,v as r,x as l,o as n,c as m,e as d,w as i,a as p,f as u,t as c,i as f,y as g,j as v,F as b,l as j,_ as h}from"./index-lnK3vi2u.js";import{E as y,a as _}from"./el-col-BaaUI79S.js";import{E as k}from"./el-card-Bnv5_xAI.js";import{E as x}from"./el-progress-DqL15mAd.js";import{E as w}from"./el-text-B59PEWrW.js";import"./el-tooltip-l0sNRNKZ.js";import{E as N}from"./el-popper-u58bCfVz.js";import{_ as C}from"./Table.vue_vue_type_script_lang-Ddm6485n.js";import{E}from"./el-tag-BuYucu0j.js";import{g as F}from"./index-BjpeWDWs.js";import{g as U}from"./index-fMWEXd-N.js";import"./el-skeleton-item-BOUZIBUH.js";import"./CountTo.vue_vue_type_script_setup_true_lang-QkzRYz2H.js";import"./index-BlMFUDDZ.js";import"./el-table-column-0AlIaPKN.js";import"./index-W8_TjnTK.js";import"./debounce-D1p90kO3.js";import"./el-checkbox-DZ6O993m.js";import"./isArrayLikeObject-CXclMpK0.js";import"./raf-BAxP01Hz.js";import"./el-pagination-B5C7bQ26.js";import"./el-select-S7B-i-tn.js";import"./strings-D_ONF1MI.js";import"./useInput-C2svBfmf.js";import"./el-image-viewer-CJ6msFhC.js";import"./el-empty-Cpo3UJLh.js";import"./tsxHelper-Dd9KbMFH.js";import"./el-dropdown-item-5WGALSI3.js";import"./castArray-Vw7lTMUi.js";import"./refs-CYfXX6dK.js";import"./index-DaGTYmBc.js";const A=h(t({__name:"Analysis",setup(t){const{t:h}=j(),A=s(!0),I=o([{field:"nodeName",label:h("node.nodeName")},{field:"taskCount",label:h("node.taskCount"),formatter:(e,a,t)=>r(E,{round:!0,effect:"dark"},(()=>t))},{field:"nodeStatus",label:h("node.nodeStatus"),formatter:(e,a,t)=>r(E,{type:"1"===t?"success":"2"===t?"warning":"danger",effect:"dark"},(()=>h("1"==t?"node.statusRun":"2"==t?"node.statusStop":"node.statusError")))}]),T=o([{field:"name",label:h("task.taskName")},{field:"taskNum",label:h("task.taskCount"),formatter:(e,a,t)=>r(E,{round:!0,effect:"dark"},(()=>t))},{field:"progress",label:h("task.taskProgress"),formatter:(e,a,t)=>r(x,{percentage:t,type:"line",striped:!0,status:t<100?"":"success",stripedFlow:t<100})},{field:"creatTime",label:h("task.createTime")}]),P=o([{field:"nodeName",label:h("node.nodeName")},{field:"nodeUsageCpu",label:h("node.nodeUsageCpu"),formatter:(e,a,t)=>{let s=parseFloat(t);return s=parseFloat(s.toFixed(2)),r(x,{percentage:s,type:"dashboard",color:s<50?"#26a33f":s<=80?"#fe9900":"#df2800"})}},{field:"nodeUsageMemory",label:h("node.nodeUsageMemory"),formatter:(e,a,t)=>{let s=parseFloat(t);return s=parseFloat(s.toFixed(2)),r(x,{percentage:s,type:"dashboard",color:s<50?"#26a33f":s<80?"#fe9900":"#df2800"})}}]),S=o([{field:"name",label:h("common.name")},{field:"cversion",label:h("common.cversion")},{field:"lversion",label:h("common.lversion"),formatter:(e,a,t)=>{if(e.cversion!=e.lversion){J.value=!0;const a=e.msg.split("\\n");let s="";return a.forEach((e=>{s+=`<div>${e}</div>`})),r(N,{placement:"top",content:s,rawContent:!0},[r(w,{type:"danger"},t)])}return r(w,t)}}]);let M=s([]);const H=s([]),L=async()=>{try{const e=await F();e&&e.data&&Array.isArray(e.data.list)&&(H.value=e.data.list.map((e=>({nodeName:e.name,taskCount:e.running,nodeStatus:e.state,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum}))),M.value=o(e.data.list.map((e=>({nodeName:e.name,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum})))))}catch(e){}finally{A.value=!1}},O=s([]),R=async()=>{const e=await U("",1,10);O.value=o(e.data.list.map((e=>({name:e.name,taskNum:e.taskNum,progress:e.progress,creatTime:e.creatTime}))))},z=s([]),D=async()=>{await Promise.all([L(),R()]),A.value=!1};(async()=>{const e=await a();z.value=o(e.data.list.map((e=>({name:e.name,cversion:e.cversion,lversion:e.lversion,msg:e.msg}))))})(),D();const G=setInterval(D,1e4);l((()=>{clearInterval(G)}));const J=s(!1);return(a,t)=>(n(),m(b,null,[d(e),d(p(_),{gutter:20,justify:"space-between"},{default:i((()=>[d(p(y),{xl:12,lg:12,md:24,sm:24,xs:24},{default:i((()=>[d(p(k),{shadow:"hover",class:"mb-20px"},{header:i((()=>[u("span",null,c(p(h)("dashboard.nodeInfo")),1)])),default:i((()=>[d(p(C),{columns:I,data:H.value,stripe:"",border:!1,height:250},null,8,["columns","data"])])),_:1})])),_:1}),d(p(y),{xl:12,lg:12,md:24,sm:24,xs:24},{default:i((()=>[d(p(k),{shadow:"hover",class:"mb-20px"},{header:i((()=>[u("span",null,c(p(h)("dashboard.taskInfo")),1)])),default:i((()=>[d(p(C),{columns:T,data:O.value,stripe:"",border:!1,height:250,"tooltip-options":{offset:1,showArrow:!1,effect:"dark",enterable:!1,showAfter:0,popperOptions:{},popperClass:"test",placement:"bottom",hideAfter:0,disabled:!0}},null,8,["columns","data"])])),_:1})])),_:1}),d(p(y),{span:12},{default:i((()=>[d(p(k),{shadow:"hover",class:"mb-25px"},{header:i((()=>[u("div",null,[u("span",null,c(p(h)("node.nodeUsageStatus")),1)])])),default:i((()=>[d(p(C),{columns:P,data:p(M),highlightCurrentRow:!1,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1}),d(p(y),{span:12},{default:i((()=>[d(p(k),{shadow:"hover",class:"mb-25px"},{header:i((()=>[d(p(_),null,{default:i((()=>[d(p(y),{span:12},{default:i((()=>[u("div",null,[u("span",null,c(p(h)("common.version")),1),J.value?(n(),f(p(w),{key:0,type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:i((()=>[g("*"+c(p(h)("common.updatemsg")),1)])),_:1})):v("",!0)])])),_:1})])),_:1})])),default:i((()=>[d(p(C),{columns:S,data:z.value,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-9e7545ec"]]);export{A as default};
